<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pricing Plans</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kalam:wght@400;700&display=swap" rel="stylesheet">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    <style>
        :root {
            --bg-color: #212529;
            --card-bg: #2c3034;
            --text-color: #ffffff;
            --border-color: #495057;
            --header-bg: #1a1d20;
            --header-text: #ffffff;
            --hover-bg: #0d6efd;
        }
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
        .pricing-header {
            max-width: 700px;
            margin: auto;
        }
        .card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
        }
        .card-header {
            background-color: var(--header-bg);
            color: var(--header-text);
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .card-body .list-unstyled li {
            color: var(--text-color) !important;
            opacity: 1;
        }
        .pricing-card-title {
            color: var(--text-color);
        }
        .pricing-card-title small {
            font-family: 'Kalam', 'Arial', sans-serif;
            color: var(--text-color);
            opacity: 1;
            font-size: 1.8rem;
            font-weight: 400;
            position: relative;
            top: -0.5rem;
            left: 0.25rem;
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .card-popular {
            border: 2px solid #FFD700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }
        .most-popular-badge {
            font-size: 0.9rem;
            font-weight: bold;
            color: #FFD700;
        }
        .pricing-header .text-muted {
            color: rgba(255, 255, 255, 0.85) !important;
        }
        
        /* Auth Modal Tab Styling */
        #authModal .nav-tabs .nav-link {
            color: #495057;
            border: none;
            border-bottom: 2px solid transparent;
            background: none;
            padding: 10px 20px;
            font-weight: 500;
        }
        
        #authModal .nav-tabs .nav-link.active {
            color: #0d6efd;
            border-bottom: 2px solid #0d6efd;
            background: none;
            font-weight: 600;
        }
        
        #authModal .nav-tabs .nav-link:hover {
            color: #0d6efd;
            border-bottom: 2px solid #0d6efd;
        }
        
        #authModal .nav-tabs {
            border-bottom: 1px solid #dee2e6;
            margin-bottom: 20px;
        }
        
        /* Auth Modal Content Styling */
        #authModal .modal-content {
            background: #fff !important;
            color: #222 !important;
        }
        
        #authModal .modal-title {
            color: #222 !important;
            font-weight: 600;
        }
        
        #authModal .form-label {
            color: #222 !important;
            font-weight: 500;
        }
        
        #authModal .form-control {
            background: #fff !important;
            color: #222 !important;
            border: 1px solid #ccc !important;
        }
        
        #authModal .form-control:focus {
            border-color: #0d6efd !important;
            box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25) !important;
        }
        
        #authModal .btn-primary {
            background: #0d6efd !important;
            color: #fff !important;
            border: none !important;
        }
        
        #authModal .btn-primary:hover {
            background: #0b5ed7 !important;
        }
        
        #authModal .btn-success {
            background: #198754 !important;
            color: #fff !important;
            border: none !important;
        }
        
        #authModal .btn-success:hover {
            background: #157347 !important;
        }
    </style>
</head>
<body>
    <div class="container py-3">
        <header>
            <div class="d-flex flex-column flex-md-row align-items-center pb-3 mb-4 border-bottom">
                <a href="/" class="d-flex align-items-center text-decoration-none">
                    <span class="fs-4 text-white" style="text-rendering: optimizeLegibility; -webkit-font-smoothing: antialiased;">Business Lead Finder</span>
                </a>
            </div>

            <div class="pricing-header p-3 pb-md-4 mx-auto text-center">
                <h1 class="display-4 fw-normal">Pricing</h1>
                <p class="fs-5 text-muted">
                    Choose a plan that fits your needs. All plans start with a 14-day free trial.
                    No credit card required for the trial.
                </p>
            </div>
        </header>

        <main>
            <div class="row row-cols-1 row-cols-md-3 mb-3 text-center">
                <div class="col">
                    <div class="card mb-4 rounded-3 shadow-sm">
                        <div class="card-header py-3">
                            <h4 class="my-0 fw-normal">BASIC</h4>
                        </div>
                        <div class="card-body">
                            <h1 class="card-title pricing-card-title">$50<small>/mo</small></h1>
                            <ul class="list-unstyled mt-3 mb-4">
                                <li>50 searches per month</li>
                                <li>Export to Google Sheets</li>
                                <li>Email support</li>
                            </ul>
                            <button type="button" class="w-100 btn btn-lg btn-outline-primary" 
                                    onclick="createCheckout('{{ basic_price_id }}')">
                                Start 14-day trial
                            </button>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card mb-4 rounded-3 shadow-sm card-popular">
                        <div class="card-header py-3">
                            <span class="most-popular-badge">MOST POPULAR</span>
                            <h4 class="my-0 fw-normal">PREMIUM</h4>
                        </div>
                        <div class="card-body">
                            <h1 class="card-title pricing-card-title">$150<small>/mo</small></h1>
                            <ul class="list-unstyled mt-3 mb-4">
                                <li>150 searches per month</li>
                                <li>Filter by maximum review count</li>
                                <li>Export to Google Sheets</li>
                                <li>Priority email support</li>
                            </ul>
                            <button type="button" class="w-100 btn btn-lg btn-primary"
                                    onclick="createCheckout('{{ premium_price_id }}')">
                                Start 14-day trial
                            </button>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card mb-4 rounded-3 shadow-sm border-primary">
                        <div class="card-header py-3 text-white bg-primary border-primary">
                            <h4 class="my-0 fw-normal">PLATINUM</h4>
                        </div>
                        <div class="card-body">
                            <h1 class="card-title pricing-card-title">$500<small>/mo</small></h1>
                            <ul class="list-unstyled mt-3 mb-4">
                                <li>500 searches per month</li>
                                <li>Filter by maximum review count</li>
                                <li>Export to Google Sheets</li>
                                <li>Phone & email support</li>
                            </ul>
                            <button type="button" class="w-100 btn btn-lg btn-primary"
                                    onclick="createCheckout('{{ platinum_price_id }}')">
                                Start 14-day trial
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Auth Modal -->
    <div class="modal fade" id="authModal" tabindex="-1" aria-labelledby="authModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="authModalLabel">Sign In or Register</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-tabs" id="authTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="login-tab" data-bs-toggle="tab" data-bs-target="#login" type="button" role="tab" aria-controls="login" aria-selected="true">Sign In</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="register-tab" data-bs-toggle="tab" data-bs-target="#register" type="button" role="tab" aria-controls="register" aria-selected="false">Register</button>
                        </li>
                    </ul>
                    <div class="tab-content" id="authTabContent">
                        <!-- Login Tab -->
                        <div class="tab-pane fade show active" id="login" role="tabpanel" aria-labelledby="login-tab">
                            <form id="loginForm" class="mt-3">
                                <div class="mb-3">
                                    <label for="loginEmail" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="loginEmail" required>
                                </div>
                                <div class="mb-3">
                                    <label for="loginPassword" class="form-label">Password</label>
                                    <input type="password" class="form-control" id="loginPassword" required>
                                </div>
                                <button type="submit" class="btn btn-primary w-100">Sign In</button>
                            </form>
                        </div>
                        <!-- Register Tab -->
                        <div class="tab-pane fade" id="register" role="tabpanel" aria-labelledby="register-tab">
                            <form id="registerForm" class="mt-3">
                                <div class="mb-3">
                                    <label for="registerName" class="form-label">Name</label>
                                    <input type="text" class="form-control" id="registerName" required>
                                </div>
                                <div class="mb-3">
                                    <label for="registerEmail" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="registerEmail" required>
                                </div>
                                <div class="mb-3">
                                    <label for="registerPassword" class="form-label">Password</label>
                                    <input type="password" class="form-control" id="registerPassword" required>
                                </div>
                                <div class="mb-3">
                                    <label for="registerConfirmPassword" class="form-label">Confirm Password</label>
                                    <input type="password" class="form-control" id="registerConfirmPassword" required>
                                    <div id="passwordMatch" class="form-text text-danger" style="display: none;">Passwords do not match</div>
                                </div>
                                <button type="submit" class="btn btn-success w-100">Register</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Assistant Chat Widget -->
    <div id="aiAssistant" class="ai-assistant">
        <!-- Chat Head (Always Visible) -->
        <div id="chatHead" class="chat-head" onclick="toggleChat()">
            <div class="chat-head-icon">
                <i class="bi bi-robot"></i>
            </div>
            <div class="chat-head-status">
                <span class="status-dot"></span>
                <span class="status-text">AI Assistant</span>
            </div>
        </div>
        
        <!-- Chat Window (Hidden by Default) -->
        <div id="chatWindow" class="chat-window">
            <div class="chat-header">
                <div class="chat-title">
                    <i class="bi bi-robot"></i>
                    <span>AI Assistant</span>
                </div>
                <button class="chat-close" onclick="toggleChat()">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            
            <div class="chat-messages" id="chatMessages">
                <div class="message ai-message">
                    <div class="message-avatar">
                        <i class="bi bi-robot"></i>
                    </div>
                    <div class="message-content">
                        <p>Hello! I'm your AI assistant. How can I help you with your business lead finding today?</p>
                    </div>
                </div>
            </div>
            
            <div class="chat-input">
                <div class="input-group">
                    <input type="text" id="chatInput" placeholder="Type your message..." maxlength="500">
                    <button id="sendMessage" onclick="sendMessage()">
                        <i class="bi bi-send"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Assistant Styles -->
    <style>
        .ai-assistant {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .chat-head {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50px;
            padding: 12px 20px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 140px;
        }
        
        .chat-head:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.2);
        }
        
        .chat-head-icon {
            font-size: 1.2rem;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .chat-head-status {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            background: #4ade80;
            border-radius: 50%;
            animation: blink 2s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        .status-text {
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .chat-window {
            position: absolute;
            bottom: 70px;
            right: 0;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            display: none;
            flex-direction: column;
            overflow: hidden;
        }
        
        .chat-window.active {
            display: flex;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chat-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }
        
        .chat-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: background 0.2s ease;
        }
        
        .chat-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
        }
        
        .message {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .message.user-message {
            flex-direction: row-reverse;
        }
        
        .message-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            flex-shrink: 0;
        }
        
        .ai-message .message-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .user-message .message-avatar {
            background: #0d6efd;
            color: white;
        }
        
        .message-content {
            max-width: 70%;
        }
        
        .message-content p {
            margin: 0;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 0.9rem;
            line-height: 1.4;
        }
        
        .ai-message .message-content p {
            background: white;
            color: #333;
            border: 1px solid #e9ecef;
        }
        
        .user-message .message-content p {
            background: #0d6efd;
            color: white;
        }
        
        .chat-input {
            padding: 15px 20px;
            background: white;
            border-top: 1px solid #e9ecef;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
        }
        
        .input-group input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #e9ecef;
            border-radius: 25px;
            font-size: 0.9rem;
            outline: none;
            transition: border-color 0.2s ease;
        }
        
        .input-group input:focus {
            border-color: #667eea;
        }
        
        .input-group button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .input-group button:hover {
            transform: scale(1.05);
        }
        
        .input-group button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .chat-window {
                width: 300px;
                height: 400px;
                bottom: 60px;
                right: 0;
            }
            
            .chat-head {
                padding: 10px 15px;
                min-width: 120px;
            }
            
            .status-text {
                font-size: 0.8rem;
            }
        }
        
        @media (max-width: 480px) {
            .ai-assistant {
                bottom: 15px;
                right: 15px;
            }
            
            .chat-window {
                width: 280px;
                height: 350px;
            }
        }
    </style>

    <!-- AI Assistant JavaScript -->
    <script>
        let isChatOpen = false;
        let isTyping = false;
        
        function toggleChat() {
            const chatWindow = document.getElementById('chatWindow');
            const chatHead = document.getElementById('chatHead');
            
            if (isChatOpen) {
                chatWindow.classList.remove('active');
                chatHead.style.transform = 'translateY(0)';
            } else {
                chatWindow.classList.add('active');
                chatHead.style.transform = 'translateY(-5px)';
                document.getElementById('chatInput').focus();
            }
            
            isChatOpen = !isChatOpen;
        }
        
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message || isTyping) return;
            
            // Add user message
            addMessage(message, 'user');
            input.value = '';
            
            // Simulate AI response
            isTyping = true;
            showTypingIndicator();
            
            setTimeout(() => {
                hideTypingIndicator();
                const response = generateAIResponse(message);
                addMessage(response, 'ai');
                isTyping = false;
            }, 1000 + Math.random() * 2000);
        }
        
        function addMessage(text, sender) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.innerHTML = sender === 'ai' ? '<i class="bi bi-robot"></i>' : '<i class="bi bi-person"></i>';
            
            const content = document.createElement('div');
            content.className = 'message-content';
            content.innerHTML = `<p>${text}</p>`;
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(content);
            messagesContainer.appendChild(messageDiv);
            
            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function showTypingIndicator() {
            const messagesContainer = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message ai-message typing-indicator';
            typingDiv.id = 'typingIndicator';
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.innerHTML = '<i class="bi bi-robot"></i>';
            
            const content = document.createElement('div');
            content.className = 'message-content';
            content.innerHTML = '<p><span class="typing-dots">AI is typing</span></p>';
            
            typingDiv.appendChild(avatar);
            typingDiv.appendChild(content);
            messagesContainer.appendChild(typingDiv);
            
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }
        
        function generateAIResponse(userMessage) {
            const responses = {
                'hello': 'Hello! How can I help you with your business lead finding today?',
                'help': 'I can help you with:\n• Finding business leads\n• Understanding search features\n• Account management\n• Pricing questions\nWhat would you like to know?',
                'search': 'To search for business leads:\n1. Enter your location\n2. Choose business type\n3. Set search radius\n4. Click "Search"\nPremium users can also filter by review count!',
                'pricing': 'We offer three plans:\n• Basic: $50/mo - 50 searches\n• Premium: $150/mo - 150 searches + review filters\n• Platinum: $500/mo - 500 searches + phone support\nAll plans include a 14-day free trial!',
                'admin': 'I\'m sorry, I don\'t have information about admin features. If you need assistance with your account or the platform, please contact our support team.',
                'export': 'To export results:\n1. Complete your search\n2. Click "Export to Google Sheets"\n3. Authorize Google access\n4. Results will be saved to your Google Drive!',
                'filter': 'Review count filtering is available for Premium and Platinum users. This helps you find businesses with fewer reviews, which often have more potential for partnerships.',
                'trial': 'All plans include a 14-day free trial with no credit card required. You can upgrade or cancel anytime during the trial period.',
                'support': 'For support:\n• Email: support@businessleadfinder.com\n• Check our FAQ section\n• Use the contact form\nWe typically respond within 24 hours!'
            };
            
            // Check if user is admin or platinum
            const isAdmin = currentUser && currentUser.is_admin;
            const isPlatinum = currentUser && currentUser.current_plan === 'PLATINUM';
            
            const lowerMessage = userMessage.toLowerCase();
            
            // Platinum AI Assistant - Enhanced capabilities
            if (isPlatinum) {
                return generatePlatinumAIResponse(userMessage);
            }
            
            // Check for keywords and return appropriate response
            if (lowerMessage.includes('hello') || lowerMessage.includes('hi')) {
                return responses.hello;
            } else if (lowerMessage.includes('help')) {
                return responses.help;
            } else if (lowerMessage.includes('search') || lowerMessage.includes('find')) {
                return responses.search;
            } else if (lowerMessage.includes('price') || lowerMessage.includes('cost') || lowerMessage.includes('plan')) {
                return responses.pricing;
            } else if (lowerMessage.includes('admin')) {
                // Only provide admin info to admin users
                if (isAdmin) {
                    return 'Admin features include:\n• User management\n• System monitoring\n• Advanced analytics\n• Support tools\n• Dashboard access\nYou have access to these features through your admin dashboard.';
                } else {
                    return responses.admin;
                }
            } else if (lowerMessage.includes('export') || lowerMessage.includes('google')) {
                return responses.export;
            } else if (lowerMessage.includes('filter') || lowerMessage.includes('review')) {
                return responses.filter;
            } else if (lowerMessage.includes('trial') || lowerMessage.includes('free')) {
                return responses.trial;
            } else if (lowerMessage.includes('support') || lowerMessage.includes('contact')) {
                return responses.support;
            } else {
                return "I'm here to help with your business lead finding needs! You can ask me about:\n• How to search for leads\n• Pricing and plans\n• Export features\n• Account management\n• Support options\nWhat would you like to know?";
            }
        }
        
        function generatePlatinumAIResponse(userMessage) {
            const lowerMessage = userMessage.toLowerCase();
            
            // Platinum AI can perform automated searches
            if (lowerMessage.includes('search for') || lowerMessage.includes('find') || lowerMessage.includes('look for')) {
                return handlePlatinumSearch(userMessage);
            }
            
            // Platinum AI can vet and analyze results
            if (lowerMessage.includes('vet') || lowerMessage.includes('analyze') || lowerMessage.includes('quality')) {
                return handlePlatinumVetting(userMessage);
            }
            
            // Platinum AI can provide advanced insights
            if (lowerMessage.includes('insight') || lowerMessage.includes('analysis') || lowerMessage.includes('recommend')) {
                return handlePlatinumInsights(userMessage);
            }
            
            // Enhanced responses for Platinum users
            const platinumResponses = {
                'hello': 'Hello! I\'m your Platinum AI Assistant. I can help you with:\n• Automated business lead searches\n• Result vetting and analysis\n• Advanced insights and recommendations\n• Custom search strategies\nWhat would you like me to help you with today?',
                'help': 'As your Platinum AI Assistant, I can:\n• Search for business leads automatically\n• Vet and analyze search results\n• Provide advanced insights\n• Create custom search strategies\n• Export results to Google Sheets\n• Monitor lead quality and potential\nJust tell me what you\'re looking for!',
                'search': 'I can perform automated searches for you! Just tell me:\n• What type of business you\'re looking for\n• The location or area\n• Any specific criteria (reviews, ratings, etc.)\nI\'ll search, vet the results, and provide you with the best leads.',
                'pricing': 'You\'re on our Platinum plan ($500/mo) which includes:\n• 500 searches per month\n• AI-powered lead vetting\n• Advanced analytics\n• Phone & email support\n• Automated search capabilities\n• Priority processing',
                'admin': 'I\'m sorry, I don\'t have information about admin features. If you need assistance with your account or the platform, please contact our support team.',
                'export': 'I can automatically export your search results to Google Sheets! Just ask me to search for something, and I\'ll handle the export process for you.',
                'filter': 'I can apply advanced filtering during searches, including:\n• Review count analysis\n• Rating thresholds\n• Business type matching\n• Location optimization\n• Quality scoring\nJust tell me your criteria!',
                'trial': 'You\'re on our Platinum plan, so you have full access to all features including AI-powered searches and vetting.',
                'support': 'For Platinum support:\n• Priority phone support\n• Dedicated account manager\n• 24/7 email support\n• Custom training sessions\nContact: platinum-support@businessleadfinder.com'
            };
            
            if (lowerMessage.includes('hello') || lowerMessage.includes('hi')) {
                return platinumResponses.hello;
            } else if (lowerMessage.includes('help')) {
                return platinumResponses.help;
            } else if (lowerMessage.includes('search') || lowerMessage.includes('find')) {
                return platinumResponses.search;
            } else if (lowerMessage.includes('price') || lowerMessage.includes('cost') || lowerMessage.includes('plan')) {
                return platinumResponses.pricing;
            } else if (lowerMessage.includes('admin')) {
                return platinumResponses.admin;
            } else if (lowerMessage.includes('export') || lowerMessage.includes('google')) {
                return platinumResponses.export;
            } else if (lowerMessage.includes('filter') || lowerMessage.includes('review')) {
                return platinumResponses.filter;
            } else if (lowerMessage.includes('trial') || lowerMessage.includes('free')) {
                return platinumResponses.trial;
            } else if (lowerMessage.includes('support') || lowerMessage.includes('contact')) {
                return platinumResponses.support;
            } else {
                return "I'm your Platinum AI Assistant! I can help you with:\n• Automated business lead searches\n• Advanced result vetting and analysis\n• Custom search strategies\n• Quality scoring and insights\n• Automated exports\nJust tell me what you're looking for!";
            }
        }
        
        function handlePlatinumSearch(userMessage) {
            // Extract search parameters from user message
            const searchTerms = extractSearchTerms(userMessage);
            
            if (!searchTerms.location || !searchTerms.businessType) {
                return "I'd be happy to search for business leads for you! Please tell me:\n• What type of business you're looking for\n• The location or area\n• Any specific criteria (optional)\n\nFor example: 'Search for restaurants in New York' or 'Find coffee shops in Los Angeles'";
            }
            
            return `I'll search for ${searchTerms.businessType} in ${searchTerms.location} for you!\n\n🔍 **Search Parameters:**\n• Business Type: ${searchTerms.businessType}\n• Location: ${searchTerms.location}\n• Radius: ${searchTerms.radius || '5 miles'}\n• Max Reviews: ${searchTerms.maxReviews || 'No limit'}\n\nI'll analyze the results and provide you with the best leads, including:\n• Quality scoring\n• Partnership potential\n• Contact information\n• Business insights\n\nWould you like me to proceed with this search?`;
        }
        
        function handlePlatinumVetting(userMessage) {
            return "I can vet and analyze search results for you! I'll evaluate each business based on:\n\n📊 **Vetting Criteria:**\n• Review count and quality\n• Rating consistency\n• Business age and stability\n• Partnership potential\n• Contact accessibility\n• Market positioning\n\n🔍 **Analysis Includes:**\n• Quality score (1-10)\n• Partnership likelihood\n• Risk assessment\n• Growth potential\n• Contact readiness\n\nJust ask me to search for something, and I'll provide fully vetted results!";
        }
        
        function handlePlatinumInsights(userMessage) {
            return "I can provide advanced insights and recommendations! Here's what I analyze:\n\n📈 **Market Insights:**\n• Industry trends in your target area\n• Competition analysis\n• Market saturation levels\n• Growth opportunities\n\n🎯 **Lead Quality Analysis:**\n• Partnership potential scoring\n• Contact readiness assessment\n• Business stability indicators\n• Expansion opportunities\n\n📊 **Strategic Recommendations:**\n• Best approach strategies\n• Optimal contact timing\n• Partnership proposal suggestions\n• Risk mitigation strategies\n\nJust tell me what you're looking for, and I'll provide comprehensive insights!";
        }
        
        function extractSearchTerms(userMessage) {
            const terms = {
                location: '',
                businessType: '',
                radius: '5',
                maxReviews: null
            };
            
            // Extract location (common patterns)
            const locationPatterns = [
                /(?:in|at|near|around)\s+([A-Za-z\s,]+?)(?:\s|$)/i,
                /(?:search|find|look)\s+(?:for\s+)?[^in]*?\s+(?:in|at|near)\s+([A-Za-z\s,]+?)(?:\s|$)/i
            ];
            
            for (const pattern of locationPatterns) {
                const match = userMessage.match(pattern);
                if (match) {
                    terms.location = match[1].trim();
                    break;
                }
            }
            
            // Extract business type
            const businessPatterns = [
                /(?:search|find|look)\s+(?:for\s+)?([^in]*?)(?:\s+in|\s+at|\s+near|$)/i,
                /(?:restaurants?|coffee\s+shops?|gyms?|salons?|dentists?|lawyers?|accountants?|plumbers?|electricians?|contractors?|real\s+estate|insurance|banks?|pharmacies?|doctors?|dentists?|veterinarians?|pet\s+shops?|bookstores?|libraries?|schools?|universities?|hospitals?|clinics?|spas?|massage|yoga|fitness|gyms?|studios?|shops?|stores?|businesses?|companies?|offices?)/gi
            ];
            
            for (const pattern of businessPatterns) {
                const match = userMessage.match(pattern);
                if (match) {
                    terms.businessType = match[1] || match[0];
                    break;
                }
            }
            
            // Extract radius
            const radiusMatch = userMessage.match(/(\d+)\s*(?:mile|miles|mi)/i);
            if (radiusMatch) {
                terms.radius = radiusMatch[1];
            }
            
            // Extract max reviews
            const reviewMatch = userMessage.match(/(\d+)\s*(?:review|reviews)/i);
            if (reviewMatch) {
                terms.maxReviews = reviewMatch[1];
            }
            
            return terms;
        }
        
        // Handle Enter key in chat input
        document.addEventListener('DOMContentLoaded', function() {
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                chatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendMessage();
                    }
                });
            }
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <script>
        const stripe = Stripe('{{ stripe_publishable_key }}');
        let selectedPriceId = null;

        function createCheckout(priceId) {
            // Check if user is authenticated first
            fetch('/api/check-auth')
                .then(response => response.json())
                .then(data => {
                    if (data.is_logged_in) {
                        // User is logged in, proceed with checkout
                        proceedWithCheckout(priceId);
                    } else {
                        // User is not logged in, show auth modal
                        selectedPriceId = priceId;
                        const authModal = new bootstrap.Modal(document.getElementById('authModal'));
                        authModal.show();
                    }
                })
                .catch(error => {
                    console.error('Error checking auth:', error);
                    alert('An error occurred. Please try again.');
                });
        }

        function proceedWithCheckout(priceId) {
            fetch('/api/create-checkout-session', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ priceId: priceId }),
            })
            .then(response => response.json())
            .then(session => {
                if (session.id) {
                    return stripe.redirectToCheckout({ sessionId: session.id });
                } else {
                    alert(session.error || 'An error occurred.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while creating the checkout session.');
            });
        }

        // Handle login form submission
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // Login successful, close modal and proceed with checkout
                    const authModal = bootstrap.Modal.getInstance(document.getElementById('authModal'));
                    authModal.hide();
                    
                    if (selectedPriceId) {
                        proceedWithCheckout(selectedPriceId);
                        selectedPriceId = null;
                    }
                } else {
                    alert(data.error || 'Login failed. Please check your credentials.');
                }
            } catch (error) {
                console.error('Login error:', error);
                alert('An error occurred during login.');
            }
        });

        // Handle register form submission
        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            const passwordMatch = document.getElementById('passwordMatch');
            
            // Check if passwords match
            if (password !== confirmPassword) {
                passwordMatch.style.display = 'block';
                return;
            } else {
                passwordMatch.style.display = 'none';
            }
            
            try {
                const response = await fetch('/api/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ name, email, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // Registration successful, close modal and proceed with checkout
                    const authModal = bootstrap.Modal.getInstance(document.getElementById('authModal'));
                    authModal.hide();
                    
                    if (selectedPriceId) {
                        proceedWithCheckout(selectedPriceId);
                        selectedPriceId = null;
                    }
                } else {
                    alert(data.error || 'Registration failed. Please try again.');
                }
            } catch (error) {
                console.error('Registration error:', error);
                alert('An error occurred during registration.');
            }
        });
        
        // Add password confirmation check on input
        document.getElementById('registerConfirmPassword').addEventListener('input', function() {
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = this.value;
            const passwordMatch = document.getElementById('passwordMatch');
            
            if (confirmPassword && password !== confirmPassword) {
                passwordMatch.style.display = 'block';
            } else {
                passwordMatch.style.display = 'none';
            }
        });
    </script>
</body>
</html> 